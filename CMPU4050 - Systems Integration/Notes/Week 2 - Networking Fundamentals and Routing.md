```markdown


Week: 2  
Module: CMPU 4050 - Systems Integration  
Topic: Networking Fundamentals and Routing  
Tags: #lecture #week2 #CMPU4050

---

## ðŸ“˜ Summary

This week focuses on the **TCP/IP protocol stack, packet encapsulation, and Linux networking configuration**. Key topics include IP addressing, routing principles, NAT (masquerading), and firewall management with `iptables`. The lecture combines theoretical understanding of networking layers with practical Linux administration commands and configuration tools.

---

## ðŸ”‘ Key Concepts & Definitions

- **Encapsulation** â†’ Each TCP/IP stack layer adds headers/trailers to enable end-to-end communication.
    
- **TTL (Time to Live)** â†’ Prevents infinite routing loops by decrementing at each hop.
    
- **NAT (Network Address Translation)** â†’ Rewrites packet headers so private IPs can communicate over the internet.
    
- **iptables INPUT Chain** â†’ Filters packets destined for the local host.
    
- **iptables FORWARD Chain** â†’ Filters packets being routed through the host.
    
- **Netplan** â†’ YAML-based system in Ubuntu for persistent network configuration.
    
- **ESTABLISHED,RELATED State** â†’ iptables condition to allow return traffic from active or related sessions.
    
---

## Systems Integration: Week 2 Networking Fundamentals

The following notes are based exclusively on the lecture material _"Week 2 â€” Networking Fundamentals and Routing"_, the associated lab, and cross-referenced with the provided past examination papers.

---

## I. TCP/IP Protocol Stack Review

The TCP/IP stack solves the problem of reliable communication between $N$ computers across diverse networks.

### Layer Responsibilities and Addressing

|Layer|Responsibility|Key Data Structure|Addressing Scheme|
|:--|:--|:--|:--|
|**Application**| Services (DNS, HTTP, DHCP)|Data / Request|URLs, Service Names|
|**Transport**|Process-to-Process Communication|TCP/UDP Segment|**Port numbers** (16-bit)|
|**Network**|Host-to-Host Routing|IP Packet|**IP addresses** (32-bit IPv4)|
|**Link**|Local Network Delivery|Ethernet Frame|**MAC addresses** (48-bit)|

_Key insight: each layer solves a unique problem and adds its own addressing header._

### Packet Encapsulation

Encapsulation = adding headers/trailers per layer â†’ Application Data â†’ Transport (ports) â†’ Network (IP) â†’ Link (MAC & FCS).

- **Ethernet Frame:** Dest MAC, Src MAC, Type (`0x0800` for IPv4), Payload, FCS.
    
- **IP Header:** TTL (loop prevention), Protocol (6=TCP, 17=UDP, 1=ICMP), Src/Dest IP.
    
- **TCP Segment:** Ports, Sequence numbers, Flags (SYN, ACK, FIN).
    
- **Common Ports:** SSH 22, DNS 53/UDP, HTTP 80, HTTPS 443, DHCP 67â€“68, NFS 2049.
    

---

## II. Linux Networking Configuration and Routing

### IP Command Suite

- `ip addr show` â†’ Interfaces & IPs
    
- `ip route show` â†’ Routing table
    
- `ip link show` â†’ Link status
    
- `ip neigh show` â†’ ARP cache
    

### Routing Principles

- Enable IP forwarding:
    
    - Temp: `sudo sysctl -w net.ipv4.ip_forward=1`
        
    - Permanent: add `net.ipv4.ip_forward=1` to `/etc/sysctl.conf`
        
- Routing = longest prefix match; fallback = default route.
    
- TTL is decremented per hop.
    

### Network Address Translation (NAT)

- Private IPs need translation â†’ router rewrites Src/Dest IPs.
    
- Command: `sudo iptables -t nat -A POSTROUTING -o OUT_IF -j MASQUERADE`
    

---

## III. Firewall Security (Netfilter/iptables)

### Tables & Chains

- **Tables:**
    
    - `filter` â†’ packet filtering (default)
        
    - `nat` â†’ address translation
        
- **Chains:**
    
    - INPUT â†’ packets to host
        
    - FORWARD â†’ packets routed through host
        
    - OUTPUT â†’ packets generated by host
        

### Security and State Module

- Use `-m state --state ESTABLISHED,RELATED` to allow return traffic.
    
- Save rules with `iptables-persistent` or `netfilter-persistent`.
    

---

## IV. Key Definitions and Algorithms

### Netplan Example

```yaml
network:
  version: 2
  render: networkd
  ethernets:
    enp0s8:
      addresses: [192.168.1.1/24] 


### NAT Setup Algorithm

1. Enable IP forwarding (`/etc/sysctl.conf`).
    
2. Add masquerade rule: `iptables -t nat -A POSTROUTING -o OUT_IF -j MASQUERADE`.
    
3. Allow forwarding IN_IF â†’ OUT_IF.
    
4. Allow return traffic with `--state RELATED,ESTABLISHED`.
    
5. Save rules persistently.
    
'''

